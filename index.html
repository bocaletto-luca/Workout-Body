<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- EN: Ensure proper scaling on mobile devices // IT: Assicura una corretta visualizzazione su dispositivi mobili -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Workout Generator</title>
  
  <!-- EN: Include Bootstrap CSS for responsive design // IT: Includi Bootstrap CSS per un design responsive -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  
  <style>
    /* EN: Basic styling for body and container // IT: Stili base per il body e il container */
    body {
      background-color: #f8f9fa;
      padding-top: 40px;
      padding-bottom: 80px;
    }
    .container {
      max-width: 800px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    /* EN: Styling for the workout generator form // IT: Stile per il form del generatore di allenamenti */
    #workoutForm {
      margin-bottom: 30px;
    }
    /* EN: Styling for the workout plan container // IT: Stile per il contenitore del piano di allenamento */
    #workoutContainer {
      margin-top: 20px;
    }
    .workout-card {
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    .workout-card img {
      object-fit: cover;
      width: 100%;
      height: 200px;
    }
    /* EN: Fixed footer styling // IT: Stile per il footer fisso */
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #343a40;
      color: #fff;
      text-align: center;
      padding: 10px 0;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- EN: App Title // IT: Titolo dell'app -->
    <h1>Workout Generator</h1>
    
    <!-- EN: Workout Generator Form // IT: Form per generare l'allenamento -->
    <form id="workoutForm">
      <div class="row g-3">
        <!-- EN: Exercise Type selection // IT: Selezione del tipo di esercizio -->
        <div class="col-md-4">
          <label for="exerciseType" class="form-label">Exercise Type:</label>
          <select id="exerciseType" class="form-select">
            <!-- EN: "All" means no filter // IT: "All" significa nessun filtro -->
            <option value="all">All</option>
            <option value="strength">Strength</option>
            <option value="cardio">Cardio</option>
            <option value="flexibility">Flexibility</option>
            <option value="balance">Balance</option>
          </select>
        </div>
        <!-- EN: Intensity selection // IT: Selezione dell'intensità -->
        <div class="col-md-4">
          <label for="intensity" class="form-label">Intensity:</label>
          <select id="intensity" class="form-select">
            <option value="all">All</option>
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="advanced">Advanced</option>
          </select>
        </div>
        <!-- EN: Number of Exercises // IT: Numero di esercizi -->
        <div class="col-md-4">
          <label for="numExercises" class="form-label">Number of Exercises:</label>
          <input type="number" id="numExercises" class="form-control" value="5" min="1" max="15" />
        </div>
      </div>
      <div class="text-center mt-3">
        <button type="submit" class="btn btn-primary">Generate Workout</button>
      </div>
    </form>
    
    <!-- EN: Container to display the generated workout plan // IT: Contenitore per visualizzare il piano di allenamento generato -->
    <div id="workoutContainer" class="row"></div>
  </div>
  
  <!-- EN: Fixed Footer // IT: Footer fisso -->
  <footer>
    Workout Generator - Bocaletto Luca
  </footer>
  
  <!-- EN: Include Bootstrap Bundle JS (includes Popper) // IT: Includi Bootstrap Bundle JS (include Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    /************************************************************************************************
     * EN: Workout Generator App
     * IT: Generatore di Allenamento
     * ---------------------------------------------------------------------------------------------
     * EN: This app generates random workout routines using a free exercise database. Users can
     *     filter exercises by type (e.g., strength, cardio, flexibility, balance), intensity
     *     (beginner, intermediate, advanced), and specify the number of exercises desired.
     *     A personalized workout plan is generated by randomly selecting filtered exercises.
     *
     * IT: Questa app genera routine di allenamento casuali sfruttando un'API gratuita di esercizi.
     *     Gli utenti possono filtrare gli esercizi per tipo (ad esempio, strength, cardio, flexibility, balance),
     *     intensità (beginner, intermediate, advanced) e specificare il numero di esercizi desiderati.
     *     Un piano di allenamento personalizzato viene generato selezionando casualmente gli esercizi filtrati.
     ************************************************************************************************/
    
    // EN: Global variable to store fetched exercise data // IT: Variabile globale per memorizzare i dati degli esercizi
    let exercisesData = [];
    
    // EN: URL to the combined exercises JSON from the Free Exercise DB // IT: URL al file JSON combinato degli esercizi (Free Exercise DB)
    // Note: This URL may need to be updated based on the repository structure.
    const exercisesUrl = "https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/dist/exercises.json";
    // EN: URL prefix for exercise images from the repository // IT: Prefisso URL per le immagini degli esercizi
    const imagesPrefix = "https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/";
    
    // EN: Select DOM elements // IT: Seleziona gli elementi DOM
    const workoutForm = document.getElementById("workoutForm");
    const exerciseTypeSelect = document.getElementById("exerciseType");
    const intensitySelect = document.getElementById("intensity");
    const numExercisesInput = document.getElementById("numExercises");
    const workoutContainer = document.getElementById("workoutContainer");
    
    /**
     * EN: Fetch exercise data from the Free Exercise DB.
     * IT: Scarica i dati degli esercizi dalla Free Exercise DB.
     */
    async function fetchExercises() {
      try {
        const response = await fetch(exercisesUrl);
        if (!response.ok) {
          throw new Error("Network response not OK: " + response.status);
        }
        const data = await response.json();
        exercisesData = data;
      } catch (error) {
        console.error("Error fetching exercises data:", error);
        workoutContainer.innerHTML = "<p class='text-center text-danger'>Error fetching exercises data. Please try again later.</p>";
      }
    }
    
    /**
     * EN: Shuffle an array using Fisher–Yates algorithm.
     * IT: Mischia un array usando l'algoritmo Fisher–Yates.
     * @param {Array} array - The array to shuffle / L'array da mischiare.
     * @returns {Array} Shuffled array / Array mischiato.
     */
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    /**
     * EN: Generate a workout plan by filtering and randomly selecting exercises.
     * IT: Genera un piano di allenamento filtrando e selezionando casualmente gli esercizi.
     */
    function generateWorkout() {
      // Get form values
      const selectedType = exerciseTypeSelect.value.toLowerCase(); // EN: e.g., "strength" // IT: ad esempio "strength"
      const selectedIntensity = intensitySelect.value.toLowerCase(); // EN: e.g., "beginner" // IT: ad esempio "beginner"
      const desiredCount = parseInt(numExercisesInput.value);
      
      // Filter exercises by type if not "all"
      let filtered = exercisesData;
      if (selectedType !== "all") {
        filtered = filtered.filter(exercise => exercise.category && exercise.category.toLowerCase() === selectedType);
      }
      
      // Filter exercises by intensity if not "all"
      if (selectedIntensity !== "all") {
        filtered = filtered.filter(exercise => exercise.level && exercise.level.toLowerCase() === selectedIntensity);
      }
      
      if (filtered.length === 0) {
        workoutContainer.innerHTML = "<p class='text-center text-danger'>No exercises found matching the selected criteria.</p>";
        return;
      }
      
      // Shuffle the filtered exercises and take the desired count
      const shuffled = shuffleArray(filtered.slice());
      const selectedExercises = shuffled.slice(0, Math.min(desiredCount, shuffled.length));
      
      displayWorkout(selectedExercises);
    }
    
    /**
     * EN: Display the selected exercises as Bootstrap cards.
     * IT: Visualizza gli esercizi selezionati come card Bootstrap.
     * @param {Array} exercises - Array of exercise objects to display.
     */
    function displayWorkout(exercises) {
      workoutContainer.innerHTML = "";
      
      exercises.forEach(exercise => {
        const colDiv = document.createElement("div");
        colDiv.className = "col-12 col-md-6";
        
        const card = document.createElement("div");
        card.className = "card workout-card h-100";
        
        // If an image is available, display the first image
        if (exercise.images && exercise.images.length > 0) {
          const img = document.createElement("img");
          img.src = imagesPrefix + exercise.images[0];
          img.alt = exercise.name;
          img.className = "card-img-top";
          card.appendChild(img);
        }
        
        const cardBody = document.createElement("div");
        cardBody.className = "card-body d-flex flex-column";
        
        const title = document.createElement("h5");
        title.className = "card-title";
        title.textContent = exercise.name;
        cardBody.appendChild(title);
        
        const levelPara = document.createElement("p");
        levelPara.className = "card-text";
        levelPara.textContent = "Intensity: " + (exercise.level ? exercise.level : "N/A");
        cardBody.appendChild(levelPara);
        
        const equipmentPara = document.createElement("p");
        equipmentPara.className = "card-text";
        equipmentPara.textContent = "Equipment: " + (exercise.equipment ? exercise.equipment : "None");
        cardBody.appendChild(equipmentPara);
        
        // Primary Muscles
        const musclesPara = document.createElement("p");
        musclesPara.className = "card-text";
        if (exercise.primaryMuscles && exercise.primaryMuscles.length > 0) {
          musclesPara.textContent = "Primary Muscles: " + exercise.primaryMuscles.join(", ");
        } else {
          musclesPara.textContent = "Primary Muscles: N/A";
        }
        cardBody.appendChild(musclesPara);
        
        // Instructions (show first sentence only)
        if (exercise.instructions && exercise.instructions.length > 0) {
          const instructionsPara = document.createElement("p");
          instructionsPara.className = "card-text";
          let instructionText = exercise.instructions[0];
          // EN: Truncate if too long // IT: Tronca se troppo lungo
          if (instructionText.length > 150) {
            instructionText = instructionText.substring(0, 150) + "...";
          }
          instructionsPara.textContent = "Instructions: " + instructionText;
          cardBody.appendChild(instructionsPara);
        }
        
        card.appendChild(cardBody);
        colDiv.appendChild(card);
        workoutContainer.appendChild(colDiv);
      });
    }
    
    // EN: Add event listener for the form submission // IT: Aggiungi listener per il submit del form
    workoutForm.addEventListener("submit", function(event) {
      event.preventDefault();
      generateWorkout();
    });
    
    // EN: On initial page load, fetch the exercise data // IT: Al caricamento iniziale, scarica i dati degli esercizi
    async function init() {
      await fetchExercises();
    }
    
    init();
  </script>
</body>
</html>
